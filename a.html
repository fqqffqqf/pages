<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>24ç‚¹æ¸¸æˆ - æ‰€æœ‰è§£æ³•</title>
  <style>
    body {
      font-family: "Microsoft YaHei", sans-serif;
      max-width: 800px;
      margin: 30px auto;
      padding: 20px;
      background-color: #f9f9f9;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #2c3e50;
    }
    .controls {
      text-align: center;
      margin: 20px 0;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    .numbers {
      text-align: center;
      font-size: 24px;
      margin: 20px 0;
      font-weight: bold;
      color: #e74c3c;
    }
    .solutions {
      margin-top: 20px;
    }
    .solution-item {
      background-color: #ecf0f1;
      padding: 10px;
      margin: 8px 0;
      border-left: 4px solid #2ecc71;
      font-family: monospace;
      font-size: 16px;
    }
    .no-solution {
      color: #e67e22;
      font-style: italic;
    }
  </style>
</head>
<body>
  <h1>ğŸ”¢ 24ç‚¹æ¸¸æˆ - åˆ—å‡ºæ‰€æœ‰è§£æ³•</h1>
  <div class="controls">
    <button onclick="generateAndSolve()">ç”Ÿæˆæ–°é¢˜ç›®</button>
  </div>
  <div class="numbers" id="numbers">ç‚¹å‡»â€œç”Ÿæˆæ–°é¢˜ç›®â€å¼€å§‹</div>
  <div class="solutions" id="solutions"></div>

  <script>
    // æ£€æŸ¥ä¸¤ä¸ªæµ®ç‚¹æ•°æ˜¯å¦è¿‘ä¼¼ç›¸ç­‰ï¼ˆå®¹å¿ 1e-10 è¯¯å·®ï¼‰
    function isEqual(a, b) {
      return Math.abs(a - b) < 1e-10;
    }

    // è·å–æ‰€æœ‰æ’åˆ—ï¼ˆ4ä¸ªæ•°çš„å…¨æ’åˆ—ï¼‰
    function getPermutations(arr) {
      if (arr.length <= 1) return [arr];
      let result = [];
      for (let i = 0; i < arr.length; i++) {
        let first = arr[i];
        let rest = arr.slice(0, i).concat(arr.slice(i + 1));
        let perms = getPermutations(rest);
        for (let perm of perms) {
          result.push([first].concat(perm));
        }
      }
      return result;
    }

    // æ‰€æœ‰å¯èƒ½çš„è¿ç®—ç¬¦ç»„åˆï¼ˆ3ä¸ªä½ç½®ï¼Œæ¯ä¸ªä½ç½®4ç§è¿ç®—ï¼‰
    const ops = ['+', '-', '*', '/'];
    function getAllOpCombinations() {
      let combos = [];
      for (let a of ops)
        for (let b of ops)
          for (let c of ops)
            combos.push([a, b, c]);
      return combos;
    }

    // å®‰å…¨é™¤æ³•ï¼šé™¤é›¶è¿”å› NaN
    function safeDivide(a, b) {
      if (isEqual(b, 0)) return NaN;
      return a / b;
    }

    // æ ¹æ®è¡¨è¾¾å¼ç»“æ„è®¡ç®—å€¼
    function calculate(a, b, op) {
      switch (op) {
        case '+': return a + b;
        case '-': return a - b;
        case '*': return a * b;
        case '/': return safeDivide(a, b);
        default: return NaN;
      }
    }

    // ç”Ÿæˆæ‰€æœ‰å¯èƒ½çš„å¸¦æ‹¬å·è¡¨è¾¾å¼ï¼ˆ5ç§äºŒå‰æ ‘ç»“æ„ï¼‰
    function evaluateAllStructures(nums, ops) {
      const [a, b, c, d] = nums.map(n => parseFloat(n));
      const [o1, o2, o3] = ops;
      let results = [];

      // ((a o1 b) o2 c) o3 d
      let v1 = calculate(calculate(calculate(a, b, o1), c, o2), d, o3);
      if (!isNaN(v1) && isEqual(v1, 24))
        results.push(`((${a} ${o1} ${b}) ${o2} ${c}) ${o3} ${d}`);

      // (a o1 (b o2 c)) o3 d
      let v2 = calculate(calculate(a, calculate(b, c, o2), o1), d, o3);
      if (!isNaN(v2) && isEqual(v2, 24))
        results.push(`(${a} ${o1} (${b} ${o2} ${c})) ${o3} ${d}`);

      // (a o1 b) o2 (c o3 d)
      let v3 = calculate(calculate(a, b, o1), calculate(c, d, o3), o2);
      if (!isNaN(v3) && isEqual(v3, 24))
        results.push(`(${a} ${o1} ${b}) ${o2} (${c} ${o3} ${d})`);

      // a o1 ((b o2 c) o3 d)
      let v4 = calculate(a, calculate(calculate(b, c, o2), d, o3), o1);
      if (!isNaN(v4) && isEqual(v4, 24))
        results.push(`${a} ${o1} ((${b} ${o2} ${c}) ${o3} ${d})`);

      // a o1 (b o2 (c o3 d))
      let v5 = calculate(a, calculate(b, calculate(c, d, o3), o2), o1);
      if (!isNaN(v5) && isEqual(v5, 24))
        results.push(`${a} ${o1} (${b} ${o2} (${c} ${o3} ${d}))`);

      return results;
    }

    // ä¸»æ±‚è§£å‡½æ•°
    function solve24(numbers) {
      const perms = getPermutations(numbers);
      const opCombos = getAllOpCombinations();
      let allSolutions = new Set(); // ç”¨ Set å»é‡

      for (let p of perms) {
        for (let ops of opCombos) {
          let exprs = evaluateAllStructures(p, ops);
          for (let expr of exprs) {
            // æ ‡å‡†åŒ–è¡¨è¾¾å¼ï¼ˆç”¨äºå»é‡ï¼‰
            allSolutions.add(expr);
          }
        }
      }

      return Array.from(allSolutions).sort();
    }

    // ç”Ÿæˆ 4 ä¸ªéšæœºæ•°ï¼ˆ1~13ï¼Œå¯¹åº” A=1, J=11, Q=12, K=13ï¼‰
    function generateRandomNumbers() {
      return Array.from({ length: 4 }, () => Math.floor(Math.random() * 13) + 1);return Array.from({ length: 4 }, () => Math.floor(Math.random() * 13) + 1);      const display = nums.map(formatNumber).join(' , '); Array.from({ length: 4 }, () => Math.floor(Math.random() * 13) + 1);
    }

    // æ•°å­—è½¬æ˜¾ç¤ºï¼ˆä¿ç•™åŸæ ·ï¼Œæˆ–å¯é€‰æ˜ å°„ä¸º A,J,Q,Kï¼‰// æ•°å­—è½¬æ˜¾ç¤ºï¼ˆä¿ç•™åŸæ ·ï¼Œæˆ–å¯é€‰æ˜ å°„ä¸º A,J,Q,Kï¼‰
    function formatNumber(n) {function formatNumber(n) {
      // å¯é€‰ï¼šreturn n === 1 ? 'A' : n === 11 ? 'J' : n === 12 ? 'Q' : n === 13 ? 'K' : n;// å¯é€‰ï¼šreturn n === 1 ? 'A' : n === 11 ? 'J' : n === 12 ? 'Q' : n === 13 ? 'K' : n;
      return n;return n;
    }

    // ä¸»å…¥å£
    function generateAndSolve() {function generateAndSolve() {
      const nums = generateRandomNumbers();const nums = generateRandomNumbers();
      const display = nums.map(formatNumber).join(' , ');const display = nums.map(formatNumber).join(' , ');
      document.getElementById('numbers').textContent = `æ•°å­—ï¼š${display}`;document.getElementById('numbers').textContent = `æ•°å­—ï¼š${display}`;

      const solutions = solve24(nums);const solutions = solve24(nums);

      const solDiv = document.getElementById('solutions');const solDiv = document.getElementById('solutions');
      if (solutions.length === 0) {if (solutions.length === 0) {
        solDiv.innerHTML = '<p class="no-solution">âŒ æ— è§£ï¼è¿™ç»„æ•°å­—æ— æ³•ç®—å‡º24ã€‚</p>';solDiv.innerHTML = '<p class="no-solution">âŒ æ— è§£ï¼è¿™ç»„æ•°å­—æ— æ³•ç®—å‡º24ã€‚</p>';
      } else {} else {
        solDiv.innerHTML = `solDiv.innerHTML =           <p>âœ… æ‰¾åˆ° ${solutions.length} ç§è§£æ³•ï¼š</p>
          <p>âœ… æ‰¾åˆ° ${solutions.          ${solutions.map(s => `<div class="solution-item">${s} = 24</div>`).join('')}} ç§è§£æ³•ï¼š</p>
          ${solutions.map(s => `<div class="solution-item">${s} = 24</div>`).join('')}
        `;
      }
    }
  </script>
</body>
</html>
